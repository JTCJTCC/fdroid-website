---
layout: page
title: Vulnerability Scanning with Drozer

---

F-Droid now includes a means of running automated vulnerability
scanning using [Drozer](https://github.com/mwrlabs/drozer). This is
achieved by starting a docker container, with the Android SDK and
Emulator prepared already, installing drozer into the emulator and
scripting the knobs to scan any fully built and signed APKs.

Note: if your application is not intended to run within an Android
emulator, please do not continue with these instructions. At this
time, the _dscanner_ feature is fully dependent upon your application
running properly in an emulated environment.

### Quick Start


1. Ensure that your application is a signed release build
1. `fdroid dscanner --init-only` from within the repo
1. Go for a coffee, this takes a long time and requires approximately
6 GB of disk space. Once this is complete, you'll be left with a docker
container running and ready to go.
1. `fdroid dscanner --latest app.pkg.name` from within the repo
to run drozer on the latest build of _app.pkg.name_
1. If all went well, there should be an _app.pkg.name_CODE.apk.dscanner_
file in the repo (next to the original APK file)
1. When you're all done scanning packages, you can cleanup the docker
container with: `fdroid dscanner --clean-only`


You can also run the drozer scan as an optional part of the overall
`fdroid build` operation. This option will trigger a drozer scan of
all signed APKs found in the repo. See `fdroid build --help` for more
information.

### Command Line Help

```
usage: fdroid dscanner [options] [APPID[:VERCODE] [APPID[:VERCODE] ...]]

positional arguments:
  app_id                app-id with optional versioncode in the form
                        APPID[:VERCODE]

optional arguments:
  -h, --help            show this help message and exit
  -v, --verbose         Spew out even more information than normal
  -q, --quiet           Restrict output to warnings and errors
  -l, --latest          Scan only the latest version of each package
  --clean-after         Clean after all scans have finished.
  --clean-before        Clean before the scans start and rebuild the
                        container.
  --clean-only          Clean up all containers and then exit.
  --init-only           Prepare drozer to run a scan
  --repo-path REPO_PATH
                        Override repo path for built APK files.
```


### From Scratch

Because the docker image used to do the Android Emulator and all of
that takes a considerable amount of time to prepare, one has been
uploaded to dockerhub.com for general use. However, the astute
researcher will be weary of any black boxes and want to build their
own black box. This section elaborates how to build the docker image
yourself.

From within the F-Droid Server source code directory, `cd ./docker/`
in order to begin.

Within this directory are the custom scripting used within the docker
image creation. For conveience, there is a simple Makefile that wraps
the process of creating images into convenient pieces.


#### `make help`

```
usage: make help|build|clean|kill|info

  help    this help screen
  build   create docker image
  clean   remove images and containers
  kill    stop running containers
  info    details of running container
```


#### `make clean`

Stops any running containers (`make kill`) and then forcully
removes them from docker. After that, all images associated are also
explicitly removed.

Note: this will destroy docker images!


#### `make build`

Builds the actual docker container, tagged
_dscanner/fdroidserver:latest_ from the local directory. Obviously
this is operating with the `Dockerfile` to build and tie everything
together nicely.


#### `make kill`

`docker kill` the container tagged _dscanner_.


#### `make info`

Prints some useful information about the currently running dscanner
container (if it is even running). The output of this command is
confusing and raw but useful none-the-less. See example output below:

```
CONTAINER ID        IMAGE                   COMMAND
CREATED             STATUS              PORTS
NAMES
b90a60afe477        dscanner/fdroidserver   "/home/drozer/entrypo"   20
minutes ago      Up 20 minutes       0.0.0.0:32779->22/tcp,
0.0.0.0:32778->5037/tcp, 0.0.0.0:32777->5554/tcp,
0.0.0.0:32776->5555/tcp, 0.0.0.0:32775->5900/tcp,
0.0.0.0:32774->5901/tcp   dscanner
Use:
 adb kill-server
 adb connect 172.17.0.2:32776
```

Typical usage is for finding the _adb connect_ line or the _ssh_
port (32779 from the `0.0.0.0:32779->22/tcp` note).
